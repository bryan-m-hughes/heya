/*
The MIT License (MIT)

Copyright (c) 2015 Bryan Hughes <bryan@theoreticalideations.com>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/

"use strict";

var EventEmitter = require("events").EventEmitter;
var util = require("util");

module.exports = DigitalJoystick;

function DigitalJoystick(options) {
  this._options = options || {};
}
util.inherits(DigitalJoystick, EventEmitter);

DigitalJoystick.prototype.connect = function connect(cb) {
  var five = require("johnny-five");
  var board = new five.Board({
    io: this._options.io,
    repl: false,
    id: "digital_joystick"
  });

  board.on("ready", (function () {
    var state = {
      up: false,
      right: false,
      down: false,
      left: false
    };

    var process = (function process() {
      var key = 0;
      if (state.up) {
        key += 1;
      }
      if (state.right) {
        key += 2;
      }
      if (state.down) {
        key += 4;
      }
      if (state.left) {
        key += 8;
      }
      var direction;
      switch (key) {
        case 0:
          direction = {
            x: 0,
            y: 0
          };
          break;
        case 1:
          direction = {
            x: 0,
            y: 1
          };
          break;
        case 3:
          direction = {
            x: 0.707,
            y: 0.707
          };
          break;
        case 2:
          direction = {
            x: 1,
            y: 0
          };
          break;
        case 6:
          direction = {
            x: 0.707,
            y: -0.707
          };
          break;
        case 4:
          direction = {
            x: 0,
            y: -1
          };
          break;
        case 12:
          direction = {
            x: -0.707,
            y: -0.707
          };
          break;
        case 8:
          direction = {
            x: -1,
            y: 0
          };
          break;
        case 9:
          direction = {
            x: -0.707,
            y: 0.707
          };
          break;
      }
      if (direction) {
        this.emit("move", direction);
      }
    }).bind(this);

    function initPin(pin, name) {
      var button = new five.Button({
        pin: pin,
        id: "digital_joystick"
      });
      button.on("press", function () {
        state[name] = true;
        process();
      });
      button.on("release", function () {
        state[name] = false;
        process();
      });
    }

    initPin(this._options.left, "left");
    initPin(this._options.right, "right");
    initPin(this._options.up, "up");
    initPin(this._options.down, "down");

    cb();
  }).bind(this));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXJzL2RpZ2l0YWxfam95c3RpY2svZGlnaXRhbF9qb3lzdGljay5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQSxJQUFJLFlBQVksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDO0FBQ2xELElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQzs7QUFFM0IsTUFBTSxDQUFDLE9BQU8sR0FBRyxlQUFlLENBQUM7O0FBRWpDLFNBQVMsZUFBZSxDQUFDLE9BQU8sRUFBRTtBQUNoQyxNQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7Q0FDL0I7QUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFZLENBQUMsQ0FBQzs7QUFFN0MsZUFBZSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsU0FBUyxPQUFPLENBQUMsRUFBRSxFQUFFO0FBQ3ZELE1BQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUNsQyxNQUFJLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUM7QUFDekIsTUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtBQUNwQixRQUFJLEVBQUUsS0FBSztBQUNYLE1BQUUsRUFBRSxrQkFBa0I7R0FDdkIsQ0FBQyxDQUFDOztBQUVILE9BQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUEsWUFBVztBQUMzQixRQUFJLEtBQUssR0FBRztBQUNWLFFBQUUsRUFBRSxLQUFLO0FBQ1QsV0FBSyxFQUFFLEtBQUs7QUFDWixVQUFJLEVBQUUsS0FBSztBQUNYLFVBQUksRUFBRSxLQUFLO0tBQ1osQ0FBQzs7QUFFRixRQUFJLE9BQU8sR0FBRyxDQUFBLFNBQVMsT0FBTyxHQUFHO0FBQy9CLFVBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNaLFVBQUksS0FBSyxDQUFD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QUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDaEMsV0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDOztBQUVwQyxNQUFFLEVBQUUsQ0FBQztHQUVOLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztDQUNmLENBQUMiLCJmaWxlIjoiY29udHJvbGxlcnMvZGlnaXRhbF9qb3lzdGljay9kaWdpdGFsX2pveXN0aWNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblRoZSBNSVQgTGljZW5zZSAoTUlUKVxuXG5Db3B5cmlnaHQgKGMpIDIwMTUgQnJ5YW4gSHVnaGVzIDxicnlhbkB0aGVvcmV0aWNhbGlkZWF0aW9ucy5jb20+XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cblRIRSBTT0ZUV0FSRS5cbiovXG5cbnZhciBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKS5FdmVudEVtaXR0ZXI7XG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBEaWdpdGFsSm95c3RpY2s7XG5cbmZ1bmN0aW9uIERpZ2l0YWxKb3lzdGljayhvcHRpb25zKSB7XG4gIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xufVxudXRpbC5pbmhlcml0cyhEaWdpdGFsSm95c3RpY2ssIEV2ZW50RW1pdHRlcik7XG5cbkRpZ2l0YWxKb3lzdGljay5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoY2IpIHtcbiAgdmFyIGZpdmUgPSByZXF1aXJlKCdqb2hubnktZml2ZScpO1xuICB2YXIgYm9hcmQgPSBuZXcgZml2ZS5Cb2FyZCh7XG4gICAgaW86IHRoaXMuX29wdGlvbnMuaW8sXG4gICAgcmVwbDogZmFsc2UsXG4gICAgaWQ6ICdkaWdpdGFsX2pveXN0aWNrJ1xuICB9KTtcblxuICBib2FyZC5vbigncmVhZHknLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3RhdGUgPSB7XG4gICAgICB1cDogZmFsc2UsXG4gICAgICByaWdodDogZmFsc2UsXG4gICAgICBkb3duOiBmYWxzZSxcbiAgICAgIGxlZnQ6IGZhbHNlXG4gICAgfTtcblxuICAgIHZhciBwcm9jZXNzID0gZnVuY3Rpb24gcHJvY2VzcygpIHtcbiAgICAgIHZhciBrZXkgPSAwO1xuICAgICAgaWYgKHN0YXRlLnVwKSB7XG4gICAgICAgIGtleSArPSAweDAxO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXRlLnJpZ2h0KSB7XG4gICAgICAgIGtleSArPSAweDAyO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXRlLmRvd24pIHtcbiAgICAgICAga2V5ICs9IDB4MDQ7XG4gICAgICB9XG4gICAgICBpZiAoc3RhdGUubGVmdCkge1xuICAgICAgICBrZXkgKz0gMHgwODtcbiAgICAgIH1cbiAgICAgIHZhciBkaXJlY3Rpb247XG4gICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlIDB4MDA6XG4gICAgICAgICAgZGlyZWN0aW9uID0ge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICB9O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDB4MDE6XG4gICAgICAgICAgZGlyZWN0aW9uID0ge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDFcbiAgICAgICAgICB9O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDB4MDM6XG4gICAgICAgICAgZGlyZWN0aW9uID0ge1xuICAgICAgICAgICAgeDogMC43MDcsXG4gICAgICAgICAgICB5OiAwLjcwN1xuICAgICAgICAgIH07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMHgwMjpcbiAgICAgICAgICBkaXJlY3Rpb24gPSB7XG4gICAgICAgICAgICB4OiAxLFxuICAgICAgICAgICAgeTogMFxuICAgICAgICAgIH07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMHgwNjpcbiAgICAgICAgICBkaXJlY3Rpb24gPSB7XG4gICAgICAgICAgICB4OiAwLjcwNyxcbiAgICAgICAgICAgIHk6IC0wLjcwN1xuICAgICAgICAgIH07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMHgwNDpcbiAgICAgICAgICBkaXJlY3Rpb24gPSB7XG4gICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgeTogLTFcbiAgICAgICAgICB9O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDB4MEM6XG4gICAgICAgICAgZGlyZWN0aW9uID0ge1xuICAgICAgICAgICAgeDogLTAuNzA3LFxuICAgICAgICAgICAgeTogLTAuNzA3XG4gICAgICAgICAgfTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAweDA4OlxuICAgICAgICAgIGRpcmVjdGlvbiA9IHtcbiAgICAgICAgICAgIHg6IC0xLFxuICAgICAgICAgICAgeTogMFxuICAgICAgICAgIH07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMHgwOTpcbiAgICAgICAgICBkaXJlY3Rpb24gPSB7XG4gICAgICAgICAgICB4OiAtMC43MDcsXG4gICAgICAgICAgICB5OiAwLjcwN1xuICAgICAgICAgIH07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoZGlyZWN0aW9uKSB7XG4gICAgICAgIHRoaXMuZW1pdCgnbW92ZScsIGRpcmVjdGlvbik7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgZnVuY3Rpb24gaW5pdFBpbihwaW4sIG5hbWUpIHtcbiAgICAgIHZhciBidXR0b24gPSBuZXcgZml2ZS5CdXR0b24oe1xuICAgICAgICBwaW46IHBpbixcbiAgICAgICAgaWQ6ICdkaWdpdGFsX2pveXN0aWNrJ1xuICAgICAgfSk7XG4gICAgICBidXR0b24ub24oJ3ByZXNzJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHN0YXRlW25hbWVdID0gdHJ1ZTtcbiAgICAgICAgcHJvY2VzcygpO1xuICAgICAgfSk7XG4gICAgICBidXR0b24ub24oJ3JlbGVhc2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgc3RhdGVbbmFtZV0gPSBmYWxzZTtcbiAgICAgICAgcHJvY2VzcygpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaW5pdFBpbih0aGlzLl9vcHRpb25zLmxlZnQsICdsZWZ0Jyk7XG4gICAgaW5pdFBpbih0aGlzLl9vcHRpb25zLnJpZ2h0LCAncmlnaHQnKTtcbiAgICBpbml0UGluKHRoaXMuX29wdGlvbnMudXAsICd1cCcpO1xuICAgIGluaXRQaW4odGhpcy5fb3B0aW9ucy5kb3duLCAnZG93bicpO1xuXG4gICAgY2IoKTtcblxuICB9LmJpbmQodGhpcykpO1xufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==